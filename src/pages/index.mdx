import { useContext, useEffect } from 'react';
import { BadOmenContext } from '../contexts/BadOmenContext';
import OnlinePlayersBox from '../components/OnlinePlayersBox';
import Hero from '../components/Hero';
import AllPlayersRegistered from '../components/AllPlayersRegisteredBox';
import { fetchStatus, getPlayerList } from '../services';

export default function Page({ allPlayers, status }) {
  const { updateStatus } = useContext(BadOmenContext);

  useEffect(() => {
    updateStatus(status);
  }, []);

  return (
    <>
      <Hero status={status} />

      <div
        className="grid grid-cols-none gap-4 px-2 py-4 mx-auto md:grid-cols-4 md:gap-6 md:py-12 md:px-6 lg:px-16 max-w-screen-2xl">
        <div className="order-1 col-span-1 space-y-4 md:order-none">
          <div>
            <OnlinePlayersBox status={status} />
          </div>

          <iframe
            src="https://discord.com/widget?id=951998050358951966&amp;theme=dark"
            width="100%"
            height="500"
            frameBorder="0"
            sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"
          ></iframe>
        </div>
        <div className="order-3 col-span-1 space-y-4 md:col-span-2 md:order-none">
          <AllPlayersRegistered status={status} players={allPlayers} />
          <div>
            <div className="bg-white dark:bg-gray-800 rounded px-4 py-3 shadow">
              <h3 className="font-extrabold text-gray-800 dark:text-gray-200">
                Mapa DinÃ¢mico
              </h3>
              <iframe src="https://map.badomen.fun/" className="w-full h-96" />
            </div>
          </div>
        </div>
        <div className="order-1 col-span-1 space-y-4 md:order-none">

          <iframe id='kofiframe' src='https://ko-fi.com/devbaraus/?hidefeed=true&widget=true&embed=true&preview=true'
                  className='border-none w-full bg-transparent h-[600px]'
                  title='devbaraus'></iframe>

        </div>

      </div>
    </>
  );
}

export async function getServerSideProps() {
  const allPlayers = (await getPlayerList()).filter(player => player.name !== 'nolsup')
  const status = await fetchStatus();

  return {
    props: {
      allPlayers,
      status
    }
  }
}